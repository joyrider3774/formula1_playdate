app-id: com.github.joyrider3774.formula1_playdate
runtime: org.freedesktop.Platform
runtime-version: "23.08"
sdk: org.freedesktop.Sdk
command: /app/game/game

finish-args:
  - --device=all # needed for gamepads
  - --share=ipc  # needed for X11
  - --socket=x11
  - --socket=pulseaudio
  - --filesystem=home:rw
  
cleanup:
  - "/include"
  - "*.a"
  - "/lib/pkgconfig"
  
modules:
  - name: SDL2_gfx
    config-opts: 
      - --disable-static
      - --disable-mmx
    build-options:
      arch:
        i386:
          config-opts:
            - --enable-mmx
        x86_64:
          config-opts:
            - --enable-mmx
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/project/sdl2gfx/SDL2_gfx-1.0.4.tar.gz
        sha256: 63e0e01addedc9df2f85b93a248f06e8a04affa014a835c2ea34bfe34e576262
  - name: Game
    buildsystem: simple
    build-commands:  
      - make "SRC_C_DIR=src/srcgame src/srcgame/scoresubmit" "CFLAGS_EXTRA=`pkg-config --cflags SDL2_gfx`" "LDFLAGS_EXTRA=`pkg-config --libs SDL2_gfx`" WINDOWSCALE=2 SCREENRESX=320 SCREENRESY=240
      - mv Source /app/game
    sources:
      - type: dir
        path: ../
